<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ YouTube MP3 ƒ∞ndirici</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0c10;
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: #161c22;
            border-radius: 24px;
            padding: 24px;
        }
        h1 { text-align: center; margin-bottom: 24px; color: #fff; }
        .user-info {
            background: #1e262e;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #2b86ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .search-box {
            background: #1e262e;
            border-radius: 16px;
            display: flex;
            margin-bottom: 16px;
        }
        input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 16px;
            color: white;
            font-size: 16px;
            outline: none;
        }
        .btn {
            background: #2b86ff;
            border: none;
            border-radius: 14px;
            padding: 16px;
            color: white;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .btn-green { background: #00b09b; }
        .result {
            background: #1e262e;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .result.active { display: block; }
        .video-info {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        .thumb {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: #2a3440;
        }
        .thumb img {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            object-fit: cover;
        }
        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .loading.active { display: block; }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2a3440;
            border-top: 3px solid #2b86ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .success {
            background: rgba(0, 176, 155, 0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        .success.active { display: block; }
        .success-icon { font-size: 48px; margin-bottom: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ MP3 ƒ∞ndirici</h1>
        
        <div id="userInfo" class="user-info">
            <div id="avatar" class="avatar">üë§</div>
            <div>
                <div id="userName" style="font-weight: 600;">Y√ºkl…ônir...</div>
                <div id="userId" style="color: #8e9aaf; font-size: 13px;"></div>
            </div>
        </div>
        
        <div class="search-box">
            <input type="text" id="query" placeholder="Mahnƒ± adƒ± v…ô ya YouTube linki..." autofocus>
        </div>
        
        <button class="btn" onclick="searchMusic()">üîç YouTube'da Axtar</button>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div id="loadingText">Axtarƒ±lƒ±r...</div>
        </div>
        
        <div id="result" class="result">
            <div class="video-info">
                <div id="thumbnail" class="thumb">üéµ</div>
                <div style="flex: 1;">
                    <div id="videoTitle" style="font-weight: 600; margin-bottom: 5px;"></div>
                    <div id="videoChannel" style="color: #8e9aaf; font-size: 14px;"></div>
                    <div id="videoDuration" style="color: #8e9aaf; font-size: 12px; margin-top: 5px;"></div>
                </div>
            </div>
            <button class="btn btn-green" onclick="downloadMP3()">üì• MP3 ƒ∞ndir v…ô G√∂nd…ôr</button>
        </div>
        
        <div id="success" class="success">
            <div class="success-icon">‚úÖ</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">MP3 G√∂nd…ôrildi!</div>
            <div id="successMessage" style="color: #b0c4de;">Telegram'ƒ± yoxlayƒ±n üì≤</div>
        </div>
    </div>

    <script>
        let telegramId = null;
        let currentVideo = null;
        
        // Telegram WebApp
        try {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                const user = Telegram.WebApp.initDataUnsafe?.user;
                if (user) {
                    telegramId = user.id;
                    const name = user.first_name || 'ƒ∞stifad…ô√ßi';
                    document.getElementById('userName').innerText = name;
                    document.getElementById('userId').innerText = `ID: ${user.id}`;
                    document.getElementById('avatar').innerText = name.charAt(0).toUpperCase();
                }
            }
        } catch(e) {
            console.log('Telegram error:', e);
        }

        // ========== YOUTUBE API KULLANIMI ==========
        const API_KEY = 'AIzaSyBOtbH8qQ_9t0rUz2mI_8ZUARY7rx46rUc'; // √úCRETSƒ∞Z YOUTUBE API KEY
        
        async function searchMusic() {
            const query = document.getElementById('query').value.trim();
            if (!query) {
                alert('Mahnƒ± adƒ± yazƒ±n!');
                return;
            }
            
            document.getElementById('loading').classList.add('active');
            document.getElementById('result').classList.remove('active');
            document.getElementById('success').classList.remove('active');
            document.getElementById('loadingText').innerText = 'YouTube axtarƒ±lƒ±r...';
            
            try {
                // YouTube API ile arama
                const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=1&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`;
                const searchRes = await fetch(searchUrl);
                const searchData = await searchRes.json();
                
                if (searchData.items && searchData.items.length > 0) {
                    const video = searchData.items[0];
                    const videoId = video.id.videoId;
                    const videoTitle = video.snippet.title;
                    const videoChannel = video.snippet.channelTitle;
                    const thumbnail = video.snippet.thumbnails.high.url;
                    
                    // Video detaylarƒ±nƒ± al
                    const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoId}&key=${API_KEY}`;
                    const detailsRes = await fetch(detailsUrl);
                    const detailsData = await detailsRes.json();
                    
                    // S√ºreyi formatla
                    let duration = '';
                    if (detailsData.items && detailsData.items[0]) {
                        const isoDuration = detailsData.items[0].contentDetails.duration;
                        duration = isoDuration.replace('PT', '').replace('H', ':').replace('M', ':').replace('S', '');
                    }
                    
                    currentVideo = {
                        id: videoId,
                        title: videoTitle,
                        url: `https://www.youtube.com/watch?v=${videoId}`,
                        channel: videoChannel,
                        thumbnail: thumbnail,
                        duration: duration
                    };
                    
                    document.getElementById('videoTitle').innerText = videoTitle;
                    document.getElementById('videoChannel').innerText = videoChannel;
                    document.getElementById('videoDuration').innerText = duration ? `‚è±Ô∏è ${duration}` : '';
                    document.getElementById('thumbnail').innerHTML = `<img src="${thumbnail}" alt="thumbnail">`;
                    
                    document.getElementById('loading').classList.remove('active');
                    document.getElementById('result').classList.add('active');
                } else {
                    throw new Error('Video tapƒ±lmadƒ±');
                }
            } catch(e) {
                alert('X…ôta: ' + e.message);
                document.getElementById('loading').classList.remove('active');
            }
        }
        
        async function downloadMP3() {
            if (!telegramId) {
                alert('Telegram ID tapƒ±lmadƒ±! Bot √ºz…ôrind…ôn a√ßƒ±n.');
                return;
            }
            
            if (!currentVideo) {
                alert('∆èvv…ôlc…ô musiqi axtarƒ±n!');
                return;
            }
            
            document.getElementById('result').classList.remove('active');
            document.getElementById('loading').classList.add('active');
            document.getElementById('loadingText').innerText = 'Bot hazƒ±rlayƒ±r...';
            
            try {
                // BOTA MESAJ G√ñND∆èR
                const botToken = "5246489165:AAGhMleCadeh3bhtje1EBPY95yn2rDKH7KE";
                const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
                
                const message = `üéµ *Yeni MP3 ist…ôyi!*\n\n` +
                              `üìå *Ba≈ülƒ±q:* ${currentVideo.title}\n` +
                              `üì∫ *Kanal:* ${currentVideo.channel}\n` +
                              `üîó *Link:* ${currentVideo.url}\n\n` +
                              `‚è≥ Bot hazƒ±rlayƒ±b g√∂nd…ôr…ôc…ôk...`;
                
                const response = await fetch(telegramUrl, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: telegramId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    document.getElementById('loading').classList.remove('active');
                    document.getElementById('successMessage').innerHTML = `"${currentVideo.title.substring(0, 50)}..."<br>‚úÖ Bot hazƒ±rlayƒ±r, birazdan g…ôl…ôr!`;
                    document.getElementById('success').classList.add('active');
                    document.getElementById('query').value = '';
                } else {
                    throw new Error('Telegram x…ôtasƒ±');
                }
            } catch(e) {
                alert('X…ôta: ' + e.message);
                document.getElementById('loading').classList.remove('active');
                document.getElementById('result').classList.add('active');
            }
        }
        
        // Enter tu≈üu
        document.getElementById('query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMusic();
            }
        });
    </script>
</body>
</html>
