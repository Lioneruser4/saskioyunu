<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mafia Oyunu</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="/socket.io/socket.io.js"></script>
<style>
body { background:#111;color:white;font-family:sans-serif }
</style>
</head>

<body>

<h2 id="user"></h2>

<input id="room" placeholder="Oda No">
<button onclick="join()">GİR</button>

<div id="lobby"></div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const socket = io();

const user = {
  id: tg.initDataUnsafe.user.id,
  name: tg.initDataUnsafe.user.first_name,
  photo: tg.initDataUnsafe.user.photo_url
};

document.getElementById("user").innerText = user.name;

function join(){
  const roomId = document.getElementById("room").value;
  socket.emit("joinRoom",{ roomId, user });
}

socket.on("roomUpdate", room=>{
  document.getElementById("lobby").innerHTML =
    Object.values(room.players).map(p=>`
      <div>${p.name}</div>
    `).join("");
});

socket.on("gameStarted", room=>{
  alert("Oyun başladı! Rolün gizlidir.");
});
</script>

</body>
</html>
